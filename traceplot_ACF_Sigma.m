function traceplot_ACF_Sigma(SigmaS,nrow,ncol_even)%--------------------------------------------% function name: traceplot_ACF_Sigma%% Produce trace plots and ACF plots along with ESS for diagonal elements of % Sigma (error variances)%% Usage example:% traceplot_ACF_Sigma(SigmaS);% traceplot_ACF_Sigma(SigmaS,nrow,ncol_even);%% Inputs:% SigmaS: 2-dimensional array of stored MCMC samples for diagonal elements of Sigma (nsample by J)% nrow (optional): number of plots to display in one column per window% <--Default: nrow=3% ncol_even (optional): number of plots to display in one row per window. % Use an even number for ncol_even. (Either 2 or 4 is the best.)% <--Default: ncol_even=4%% Eun Sug Park, August 2020% Last updated February 2021%----------------------------------------[nsample,J]=size(SigmaS);n1=29;t=0:n1;ubound=1.96/sqrt(nsample);lbound=-1.96/sqrt(nsample);zmean=mean(SigmaS);roS=zeros(nsample,J);ESS=zeros(1,J);for j=1:J    z=SigmaS(:,j);    zmeanj=zmean(j);    ro=zeros(1,nsample-1);    for i=1:n1        ro(i)=((z(1:nsample-i)-zmeanj*ones(nsample-i,1))'*(z(i+1:nsample)-zmeanj*ones(nsample-i,1)))/sum((z-zmeanj*ones(nsample,1)).^2);    end    k=min(find(ro<0.05));    ESS(j)=nsample/(1+2*sum(ro(1:k)));    ro1=[1 ro];    roS(:,j)=ro1';endfigureif nargin==1      nrow=3; ncol_even=4;elseif nargin==2      ncol_even=4;endnplot=nrow*ncol_even;  %total number of plots to display per windownum_plot=min(nplot,J*2);ii=0;  for j=[1:2:(num_plot-1)]    ii=ii+1;    subplot(nrow,ncol_even,j)    plot(SigmaS(:,ii))    axis tight    xlabel('sample #')    ylabel('Sigma')    title(['Sigma[',num2str(ii),']'])        subplot(nrow,ncol_even,j+1)    hold on    stem(t,roS([1:(n1+1)],ii))    plot(t,ubound*ones(length(t)));    plot(t,0*ones(length(t)));    plot(t,lbound*ones(length(t)));    xlabel('Lag')    ylabel('ACF');    c=round(ESS(ii),2);    title(['ESS=',num2str(c)])     axis tight    hold offend